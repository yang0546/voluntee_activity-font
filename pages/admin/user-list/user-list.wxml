<view class="page">
  <view class="top-bg"></view>

  <!-- 顶部导航与欢迎 -->
  <view class="nav-bar">
    <view class="nav-left">
      <text class="nav-title">管理员工作台</text>
      <text class="nav-sub">用户管理</text>
    </view>
    <view class="nav-tabs">
      <view class="nav-tab" data-key="activity" bindtap="onNavChange">活动广场</view>
      <view class="nav-tab active">用户管理</view>
      
    </view>
  </view>

  <!-- 欢迎卡片 -->
  <view class="hero-card">
    <view class="hero-left">
      <text class="hero-label">欢迎回来</text>
      <text class="hero-title">Hi，{{welcomeName || '管理员'}}</text>
      <text class="hero-sub">查看并管理所有用户，支持筛选与编辑</text>
    </view>
    <view class="hero-stat">
      <text class="stat-label">总用户数</text>
      <text class="stat-value">{{total}}</text>
    </view>
  </view>

  <!-- 筛选卡片 -->
  <view class="card filter-card">
    <view class="card-header">
      <text class="card-title">筛选条件</text>
      <text class="card-sub">按姓名、学院、角色组合过滤</text>
    </view>
    <view class="filter-grid">
      <view class="field">
        <text class="field-label">姓名</text>
        <input class="input" placeholder="输入姓名关键字" value="{{searchParams.name}}" bindinput="onNameInput" />
      </view>
      <view class="field">
        <text class="field-label">学院</text>
        <input class="input" placeholder="例如：计算机学院" value="{{searchParams.college}}" bindinput="onCollegeInput" />
      </view>
      <view class="field">
        <text class="field-label">角色</text>
        <picker mode="selector" range="{{roleOptions}}" range-key="label" value="{{roleIndex}}" bindchange="onRoleChange">
          <view class="picker">
            <text>{{roleOptions[roleIndex].label}}</text>
            <text class="chevron">⌄</text>
          </view>
        </picker>
      </view>
      <view class="filter-actions">
        <button class="primary-btn half" bindtap="onSearch">开始筛选</button>
        <button class="ghost-btn half" bindtap="onResetFilters">重置筛选</button>
      </view>
    </view>
  </view>

  <!-- 列表头 -->
  <view class="section-head">
    <view>
      <text class="section-title">全部用户</text>
    </view>
  </view>

  <!-- 用户列表 -->
  <view class="list">
    <view class="user-card" wx:for="{{userList}}" wx:key="id" data-id="{{item.id}}" bindtap="editUser">
      <view class="role-chip role-{{item.role !== undefined && item.role !== null ? item.role : ''}}">{{item.roleText || getRoleText(item.role) || '未知'}}</view>
      <view class="avatar-shell">
        <image class="avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
      </view>
      <view class="card-content">
        <view class="card-row">
          <text class="name">{{item.name || item.userName || '未命名'}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-label">学院</text>
          <text class="meta-value">{{item.college || '未设置'}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-label">手机</text>
          <text class="meta-value">{{item.phone || '未设置'}}</text>
        </view>
        <view class="meta-row">
          <text class="meta-label">注册时间</text>
          <text class="meta-value">{{item.createTime || '未记录'}}</text>
        </view>
      </view>
      <text class="card-chevron">›</text>
    </view>

    <view class="load-more" wx:if="{{loading}}">加载中...</view>
    <view class="no-more" wx:if="{{!hasMore && userList.length > 0}}">没有更多了</view>
    <view class="empty" wx:if="{{!loading && userList.length === 0}}">暂无用户</view>
  </view>

  <admin-tabbar current="user" />
</view>
