<view class="container">
  <view class="page-header">
    <view class="hero-text">
      <text class="eyebrow">Volunteer Hub</text>
      <text class="hero-title">æ´»åŠ¨åˆ—è¡¨</text>
      <text class="hero-sub">æŒ‘é€‰æ´»åŠ¨ã€ç®¡ç†æŠ¥åï¼Œä¸€ç«™å¼å®Œæˆ</text>
      <view class="hero-stats">
        <view class="stat-pill">
          <text class="stat-label">å·²æŠ¥å</text>
          <text class="stat-number">{{applied.total || 0}}</text>
        </view>
        <view class="stat-pill">
          <text class="stat-label">å·²é€šè¿‡</text>
          <text class="stat-number">{{approved.total || 0}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="tab-bar">
    <view
      wx:for="{{tabs}}"
      wx:key="key"
      class="tab-item {{activeTab === item.key ? 'active' : ''}}"
      data-key="{{item.key}}"
      bindtap="onTabChange"
    >
      {{item.label}}
    </view>
  </view>

  <view class="search-card" wx:if="{{activeTab === 'market'}}">
    <view class="input-wrap">
      <input class="search-input" placeholder="æœç´¢æ´»åŠ¨æ ‡é¢˜" value="{{searchParams.title}}" bindinput="onSearchInput" />
    </view>
    <picker mode="selector" range="{{statusOptions}}" range-key="label" value="{{statusIndex}}" bindchange="onStatusChange">
      <view class="status-picker">
        <text>{{statusOptions[statusIndex].label}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
    <button class="search-btn" bindtap="onSearch">æœç´¢</button>
  </view>

  <scroll-view
    class="scroll-area"
    scroll-y
    refresher-enabled
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onPullDownRefresh"
    bindscrolltolower="loadActiveTabMore"
    lower-threshold="80"
  >
    <!-- æ´»åŠ¨å¹¿åœº -->
    <block wx:if="{{activeTab === 'market'}}">
      <view class="activity-item" wx:for="{{market.list}}" wx:key="id" bindtap="viewActivityDetail" data-id="{{item.id}}">
        <view class="activity-header">
          <view class="badge-dot {{getStatusClass(item.status)}}"></view>
          <text class="activity-title">{{item.title}}</text>
          <text class="status-chip {{getStatusClass(item.status)}}">{{getStatusText(item.status)}}</text>
        </view>
        <text class="activity-desc">{{item.description}}</text>
        <view class="activity-info">
          <view class="info-chip">
            <text class="icon">ğŸ“</text>
            <text>{{item.location}}</text>
          </view>
          <view class="info-chip">
            <text class="icon">â°</text>
            <text>{{item.startTimeDisplay}}</text>
          </view>
          <view class="info-chip">
            <text class="icon">ğŸ‘¥</text>
            <text>{{item.currentPeople}} / {{item.requiredPeople}}</text>
          </view>
        </view>
        <view class="activity-footer">
          <text class="leader">è´Ÿè´£äººï¼š{{item.leaderName}}</text>
          <text class="deadline">æŠ¥åæˆªæ­¢ï¼š{{item.deadlineDisplay}}</text>
        </view>
        <view class="activity-actions">
          <button
            class="signup-btn"
            type="primary"
            size="mini"
            data-id="{{item.id}}"
            catchtap="onSignup"
            disabled="{{item.isSignupClosed}}"
          >
            {{item.isSignupClosed ? 'æŠ¥åå·²æˆªæ­¢' : 'ç«‹å³æŠ¥å'}}
          </button>
        </view>
      </view>
      <view class="load-more" wx:if="{{market.loading}}">åŠ è½½ä¸­...</view>
      <view class="no-more" wx:if="{{!market.hasMore && market.list.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
      <view class="empty" wx:if="{{!market.loading && market.list.length === 0}}">æš‚æ— æ´»åŠ¨</view>
    </block>

    <!-- å·²æŠ¥å -->
    <block wx:elif="{{activeTab === 'applied'}}">
      <view class="signup-card" wx:for="{{applied.list}}" wx:key="signupId">
        <view class="signup-header">
          <text class="signup-title">{{item.title}}</text>
          <text class="audit-badge {{item.statusClass}}">{{item.statusText}}</text>
        </view>
        <text class="signup-desc">{{item.description}}</text>
        <text wx:if="{{item.status === 2 && item.auditReason}}" class="audit-reason">æ‹’ç»åŸå› ï¼š{{item.auditReason}}</text>
        <view class="signup-meta">
          <text>æŠ¥åæ—¶é—´ï¼š{{item.signupTimeDisplay}}</text>
          <text wx:if="{{item.auditTimeDisplay}}">å®¡æ ¸æ—¶é—´ï¼š{{item.auditTimeDisplay}}</text>
        </view>
      </view>
      <view class="load-more" wx:if="{{applied.loading}}">åŠ è½½ä¸­...</view>
      <view class="no-more" wx:if="{{!applied.hasMore && applied.list.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
      <view class="empty" wx:if="{{!applied.loading && applied.list.length === 0}}">æš‚æ— æŠ¥åè®°å½•</view>
    </block>

    <!-- å·²é€šè¿‡ -->
    <block wx:elif="{{activeTab === 'approved'}}">
      <view class="signup-card" wx:for="{{approved.list}}" wx:key="signupId">
        <view class="signup-header">
          <text class="signup-title">{{item.title}}</text>
          <text class="audit-badge {{item.statusClass}}">{{item.statusText}}</text>
        </view>
        <text class="signup-desc">{{item.description}}</text>
        <text wx:if="{{item.status === 2 && item.auditReason}}" class="audit-reason">æ‹’ç»åŸå› ï¼š{{item.auditReason}}</text>
        <view class="signup-meta">
          <text>æŠ¥åæ—¶é—´ï¼š{{item.signupTimeDisplay}}</text>
          <text wx:if="{{item.auditTimeDisplay}}">å®¡æ ¸æ—¶é—´ï¼š{{item.auditTimeDisplay}}</text>
        </view>
      </view>
      <view class="load-more" wx:if="{{approved.loading}}">åŠ è½½ä¸­...</view>
      <view class="no-more" wx:if="{{!approved.hasMore && approved.list.length > 0}}">æ²¡æœ‰æ›´å¤šäº†</view>
      <view class="empty" wx:if="{{!approved.loading && approved.list.length === 0}}">æš‚æ— æŠ¥åæˆåŠŸçš„æ´»åŠ¨</view>
    </block>
  </scroll-view>
</view>
