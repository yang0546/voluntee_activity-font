# 志愿者活动管理系统 API 接口文档

## 基本信息

- **服务地址**: `http://localhost:8080`
- **数据格式**: JSON
- **认证方式**: JWT Token (通过请求头 `token` 传递)

---

## 统一响应格式

所有接口统一返回 `Result<T>` 格式：

```json
{
  "code": 1, // 状态码：1-成功，0-失败
  "msg": "错误信息", // 失败时的错误信息
  "data": {} // 响应数据
}
```

### 分页响应格式

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "total": 100, // 总记录数
    "records": [] // 当前页数据集合
  }
}
```

---

## 一、公共接口

### 1.1 用户登录

**接口地址**: `POST /common/login`

**接口描述**: 微信小程序用户登录

**请求参数**:

| 参数名    | 类型   | 必填 | 说明              |
| --------- | ------ | ---- | ----------------- |
| code      | String | 是   | 微信登录凭证 code |
| name      | String | 是   | 用户姓名          |
| avatarUrl | String | 是   | 用户头像 URL      |

**请求示例**:

```json
{
  "code": "081xxx",
  "name": "张三",
  "avatarUrl": "https://xxx.com/avatar.png"
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "id": 1,
    "userName": "张三",
    "openid": "oXXX",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "role": 0
  }
}
```

**响应字段说明**:

| 字段名   | 类型    | 说明                                 |
| -------- | ------- | ------------------------------------ |
| id       | Long    | 用户 ID                              |
| userName | String  | 用户名                               |
| openid   | String  | 微信 openid                          |
| token    | String  | JWT 令牌（后续请求需在请求头中携带） |
| role     | Integer | 角色：0-志愿者，1-负责人，2-管理员   |

---

## 二、管理员接口

**基础路径**: `/admin`

**权限要求**: 需要管理员权限（role=2）

### 2.1 分页查询用户列表

**接口地址**: `GET /admin/user/list`

**接口描述**: 管理员分页查询用户列表

**请求参数**（Query 参数）:

| 参数名   | 类型    | 必填 | 默认值 | 说明                               |
| -------- | ------- | ---- | ------ | ---------------------------------- |
| page     | Integer | 否   | 1      | 当前页码                           |
| pageSize | Integer | 否   | 10     | 每页条数                           |
| name     | String  | 否   | -      | 姓名（模糊查询）                   |
| college  | String  | 否   | -      | 学院                               |
| role     | Integer | 否   | -      | 角色：0-志愿者，1-负责人，2-管理员 |

**请求示例**: `GET /admin/user/list?page=1&pageSize=10&name=张&role=0`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "total": 50,
    "records": [
      {
        "id": 1,
        "openid": "oXXX",
        "avatarUrl": "https://xxx.com/avatar.png",
        "name": "张三",
        "role": 0,
        "phone": "13800138000",
        "college": "计算机学院",
        "createTime": "2024-01-01 10:00:00",
        "updateTime": "2024-01-01 10:00:00"
      }
    ]
  }
}
```

### 2.2 更新用户信息

**接口地址**: `PUT /admin/user/update`

**接口描述**: 管理员更新用户信息

**请求参数**（Body）:

| 参数名    | 类型    | 必填 | 说明                               |
| --------- | ------- | ---- | ---------------------------------- |
| id        | Long    | 是   | 用户 ID                            |
| name      | String  | 否   | 用户姓名                           |
| phone     | String  | 否   | 手机号                             |
| college   | String  | 否   | 学院                               |
| role      | Integer | 否   | 角色：0-志愿者，1-负责人，2-管理员 |
| avatarUrl | String  | 否   | 头像 URL                           |

**请求示例**:

```json
{
  "id": 1,
  "name": "张三",
  "phone": "13800138000",
  "college": "计算机学院",
  "role": 0
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 2.3 根据 ID 查询用户信息

**接口地址**: `GET /admin/user/{id}`

**接口描述**: 根据用户 ID 查询用户详细信息

**路径参数**:

| 参数名 | 类型 | 必填 | 说明    |
| ------ | ---- | ---- | ------- |
| id     | Long | 是   | 用户 ID |

**请求示例**: `GET /admin/user/1`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "id": 1,
    "openid": "oXXX",
    "avatarUrl": "https://xxx.com/avatar.png",
    "name": "张三",
    "role": 0,
    "phone": "13800138000",
    "college": "计算机学院",
    "createTime": "2024-01-01 10:00:00",
    "updateTime": "2024-01-01 10:00:00"
  }
}
```

### 2.4 获取所有活动信息

**接口地址**: `GET /admin/activity/list`

**接口描述**: 管理员获取所有活动信息（分页）

**请求参数**（Query 参数）:

| 参数名    | 类型    | 必填 | 说明                                             |
| --------- | ------- | ---- | ------------------------------------------------ |
| page      | Integer | 否   | 当前页码                                         |
| pageSize  | Integer | 否   | 每页条数                                         |
| title     | String  | 否   | 活动标题（模糊查询）                             |
| leaderId  | Long    | 否   | 负责人 ID                                        |
| startTime | String  | 否   | 活动开始时间（格式：yyyy-MM-dd HH:mm:ss）        |
| endTime   | String  | 否   | 活动结束时间（格式：yyyy-MM-dd HH:mm:ss）        |
| status    | Integer | 否   | 活动状态：0-未开始，1-进行中，2-已结束，3-已取消 |

**请求示例**: `GET /admin/activity/list?page=1&pageSize=10&status=1`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "total": 20,
    "records": [
      {
        "id": 1,
        "title": "环保志愿者活动",
        "description": "参与社区环保清洁活动",
        "location": "XX社区",
        "startTime": "2024-03-01 09:00:00",
        "endTime": "2024-03-01 17:00:00",
        "signupDeadline": "2024-02-28 18:00:00",
        "currentPeople": 10,
        "requiredPeople": 20,
        "leaderId": 2,
        "status": 1,
        "createTime": "2024-02-01 10:00:00",
        "updateTime": "2024-02-01 10:00:00"
      }
    ]
  }
}
```

### 2.5 更新活动信息

**接口地址**: `PUT /admin/activity/update`

**接口描述**: 管理员更新活动信息

**请求参数**（Body）:

| 参数名         | 类型    | 必填 | 说明                                             |
| -------------- | ------- | ---- | ------------------------------------------------ |
| id             | Long    | 是   | 活动 ID                                          |
| title          | String  | 否   | 活动标题                                         |
| description    | String  | 否   | 活动说明                                         |
| location       | String  | 否   | 活动地点                                         |
| startTime      | String  | 否   | 活动开始时间（格式：yyyy-MM-dd HH:mm:ss）        |
| endTime        | String  | 否   | 活动结束时间（格式：yyyy-MM-dd HH:mm:ss）        |
| signupDeadline | String  | 否   | 报名截止时间（格式：yyyy-MM-dd HH:mm:ss）        |
| currentPeople  | Integer | 否   | 当前已成功人数                                   |
| requiredPeople | Integer | 否   | 所需志愿者人数                                   |
| leaderId       | Long    | 否   | 活动负责人 ID                                    |
| status         | Integer | 否   | 活动状态：0-未开始，1-进行中，2-已结束，3-已取消 |

**请求示例**:

```json
{
  "id": 1,
  "title": "环保志愿者活动（更新）",
  "description": "参与社区环保清洁活动",
  "location": "XX社区",
  "status": 1
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

---

## 三、负责人接口

**基础路径**: `/leader`

**权限要求**: 需要负责人权限（role=1）

### 3.1 创建活动

**接口地址**: `POST /leader/activity/create`

**接口描述**: 负责人创建新的志愿活动

**请求参数**（Body）:

| 参数名         | 类型    | 必填 | 说明                                      |
| -------------- | ------- | ---- | ----------------------------------------- |
| title          | String  | 是   | 活动标题                                  |
| description    | String  | 是   | 活动说明                                  |
| location       | String  | 是   | 活动地点                                  |
| startTime      | String  | 是   | 活动开始时间（格式：yyyy-MM-dd HH:mm:ss） |
| endTime        | String  | 是   | 活动结束时间（格式：yyyy-MM-dd HH:mm:ss） |
| signupDeadline | String  | 是   | 报名截止时间（格式：yyyy-MM-dd HH:mm:ss） |
| requiredPeople | Integer | 是   | 所需志愿者人数                            |
| leaderId       | Long    | 否   | 活动负责人 ID（通常从 token 中获取）      |

**请求示例**:

```json
{
  "title": "社区环保活动",
  "description": "参与社区环保清洁活动",
  "location": "XX社区广场",
  "startTime": "2024-03-01 09:00:00",
  "endTime": "2024-03-01 17:00:00",
  "signupDeadline": "2024-02-28 18:00:00",
  "requiredPeople": 20
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 3.2 获取所有活动信息

**接口地址**: `GET /leader/activity/list`

**接口描述**: 负责人获取所有活动信息（分页）

**请求参数**（Query 参数）: 同 2.4

**响应示例**: 同 2.4

### 3.3 获取自己负责的活动

**接口地址**: `GET /leader/activity/self`

**接口描述**: 负责人获取自己负责的活动信息（分页）

**请求参数**（Query 参数）: 同 2.4

**响应示例**: 同 2.4（仅返回当前负责人创建的活动）

### 3.4 更新活动

**接口地址**: `PUT /leader/activity/update`

**接口描述**: 负责人更新自己负责的活动信息

**请求参数**（Body）: 同 2.5

**响应示例**: 同 2.5

### 3.5 删除活动

**接口地址**: `DELETE /leader/activity/delete`

**接口描述**: 负责人删除自己创建的活动

**请求参数**（Query 参数）:

| 参数名 | 类型 | 必填 | 说明    |
| ------ | ---- | ---- | ------- |
| id     | Long | 是   | 活动 ID |

**请求示例**: `DELETE /leader/activity/delete?id=1`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 3.6 获取报名记录

**接口地址**: `GET /leader/activity/signupRecords`

**接口描述**: 负责人获取自己有权限审核的报名记录（分页）

**请求参数**（Query 参数）:

| 参数名     | 类型    | 必填 | 说明                               |
| ---------- | ------- | ---- | ---------------------------------- |
| page       | Integer | 否   | 当前页码                           |
| pageSize   | Integer | 否   | 每页条数                           |
| userId     | Long    | 否   | 用户 ID                            |
| activityId | Long    | 否   | 活动 ID                            |
| status     | Integer | 否   | 审核状态：0-待审核，1-通过，2-拒绝 |

**请求示例**: `GET /leader/activity/signupRecords?page=1&pageSize=10&activityId=1`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "total": 15,
    "records": [
      {
        "id": 1,
        "activityId": 1,
        "userId": 3,
        "status": 0,
        "auditReason": null,
        "createTime": "2024-02-20 10:00:00"
      }
    ]
  }
}
```

### 3.7 审核报名

**接口地址**: `PUT /leader/activity/audit`

**接口描述**: 负责人审核活动报名申请

**请求参数**（Body）:

| 参数名      | 类型    | 必填 | 说明                     |
| ----------- | ------- | ---- | ------------------------ |
| signupId    | Long    | 是   | 报名记录 ID              |
| status      | Integer | 是   | 审核结果：1-通过，2-拒绝 |
| auditReason | String  | 否   | 审核说明                 |

**请求示例**:

```json
{
  "signupId": 1,
  "status": 1,
  "auditReason": "审核通过，欢迎参与活动"
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 3.8 任务分配

**接口地址**: `POST /leader/activity/taskAssign`

**接口描述**: 负责人为志愿者分配任务

**请求参数**（Body）:

| 参数名     | 类型   | 必填 | 说明                                      |
| ---------- | ------ | ---- | ----------------------------------------- |
| activityId | Long   | 是   | 活动 ID                                   |
| userId     | Long   | 是   | 志愿者用户 ID                             |
| content    | String | 是   | 任务内容                                  |
| startTime  | String | 是   | 任务开始时间（格式：yyyy-MM-dd HH:mm:ss） |
| endTime    | String | 是   | 任务结束时间（格式：yyyy-MM-dd HH:mm:ss） |

**请求示例**:

```json
{
  "activityId": 1,
  "userId": 3,
  "content": "负责活动现场签到工作",
  "startTime": "2024-03-01 08:00:00",
  "endTime": "2024-03-01 09:00:00"
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 3.9 获取任务列表

**接口地址**: `GET /leader/activity/taskList`

**接口描述**: 负责人获取自己负责的活动任务列表

**请求参数**（Query 参数）:

| 参数名     | 类型 | 必填 | 说明    |
| ---------- | ---- | ---- | ------- |
| activityId | Long | 是   | 活动 ID |

**请求示例**: `GET /leader/activity/taskList?activityId=1`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": [
    {
      "taskId": 1,
      "userId": 3,
      "userName": "李四",
      "content": "负责活动现场签到工作",
      "status": 0,
      "startTime": "2024-03-01 08:00:00",
      "endTime": "2024-03-01 09:00:00"
    }
  ]
}
```

**响应字段说明**:

| 字段名    | 类型    | 说明                                   |
| --------- | ------- | -------------------------------------- |
| taskId    | Long    | 任务 ID                                |
| userId    | Long    | 志愿者用户 ID                          |
| userName  | String  | 志愿者姓名                             |
| content   | String  | 任务内容                               |
| status    | Integer | 任务状态：0-未开始，1-进行中，2-已完成 |
| startTime | String  | 任务开始时间                           |
| endTime   | String  | 任务结束时间                           |

### 3.10 获取活动报名成功的用户列表

**接口地址**: `GET /leader/activity/userList`

**接口描述**: 负责人根据活动 ID 查询报名成功的用户列表

**请求参数**（Query 参数）:

| 参数名     | 类型 | 必填 | 说明    |
| ---------- | ---- | ---- | ------- |
| activityId | Long | 是   | 活动 ID |

**请求示例**: `GET /leader/activity/userList?activityId=1`

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": {
    "userNameList": ["张三", "李四", "王五"]
  }
}
```

---

## 四、志愿者接口

**基础路径**: `/volunteer`

**权限要求**: 需要志愿者权限（role=0）

### 4.1 报名志愿活动

**接口地址**: `POST /volunteer/activity/signup`

**接口描述**: 志愿者报名参加志愿活动

**请求参数**（Body）:

| 参数名     | 类型 | 必填 | 说明    |
| ---------- | ---- | ---- | ------- |
| activityId | Long | 是   | 活动 ID |

**请求示例**:

```json
{
  "activityId": 1
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 4.2 获取任务列表

**接口地址**: `GET /volunteer/activity/taskList`

**接口描述**: 志愿者获取自己参与的活动对应的任务列表

**请求参数**（Query 参数）:

| 参数名     | 类型 | 必填 | 说明    |
| ---------- | ---- | ---- | ------- |
| activityId | Long | 是   | 活动 ID |

**请求示例**: `GET /volunteer/activity/taskList?activityId=1`

**响应示例**: 同 3.9

### 4.3 更新任务状态

**接口地址**: `PUT /volunteer/task/status`

**接口描述**: 志愿者更新分配给自己的任务状态

**请求参数**（Body）:

| 参数名 | 类型    | 必填 | 说明                                   |
| ------ | ------- | ---- | -------------------------------------- |
| taskId | Long    | 是   | 任务 ID                                |
| status | Integer | 是   | 任务状态：0-未开始，1-进行中，2-已完成 |

**请求示例**:

```json
{
  "taskId": 1,
  "status": 2
}
```

**响应示例**:

```json
{
  "code": 1,
  "msg": null,
  "data": null
}
```

### 4.4 获取所有活动信息

**接口地址**: `GET /volunteer/activity/list`

**接口描述**: 志愿者获取所有活动信息（分页）

**请求参数**（Query 参数）: 同 2.4

**响应示例**: 同 2.4

### 4.5 获取报名记录

**接口地址**: `GET /volunteer/activity/signupRecords`

**接口描述**: 志愿者获取自己的报名记录（分页）

**请求参数**（Query 参数）: 同 3.6

**响应示例**: 同 3.6（仅返回当前志愿者的报名记录）

---

## 五、数据模型

### 5.1 用户（User）

| 字段名     | 类型    | 说明                               |
| ---------- | ------- | ---------------------------------- |
| id         | Long    | 用户 ID                            |
| openid     | String  | 微信 openid                        |
| avatarUrl  | String  | 用户头像 URL                       |
| name       | String  | 用户姓名                           |
| role       | Integer | 角色：0-志愿者，1-负责人，2-管理员 |
| phone      | String  | 手机号                             |
| college    | String  | 学院                               |
| createTime | String  | 创建时间                           |
| updateTime | String  | 更新时间                           |

### 5.2 活动（Activity）

| 字段名         | 类型    | 说明                                             |
| -------------- | ------- | ------------------------------------------------ |
| id             | Long    | 活动 ID                                          |
| title          | String  | 活动标题                                         |
| description    | String  | 活动说明                                         |
| location       | String  | 活动地点                                         |
| startTime      | String  | 活动开始时间                                     |
| endTime        | String  | 活动结束时间                                     |
| signupDeadline | String  | 报名截止时间                                     |
| currentPeople  | Integer | 当前已成功人数                                   |
| requiredPeople | Integer | 所需志愿者人数                                   |
| leaderId       | Long    | 活动负责人 ID                                    |
| status         | Integer | 活动状态：0-未开始，1-进行中，2-已结束，3-已取消 |
| createTime     | String  | 创建时间                                         |
| updateTime     | String  | 更新时间                                         |

### 5.3 任务（Task）

| 字段名    | 类型    | 说明                                   |
| --------- | ------- | -------------------------------------- |
| taskId    | Long    | 任务 ID                                |
| userId    | Long    | 志愿者用户 ID                          |
| userName  | String  | 志愿者姓名                             |
| content   | String  | 任务内容                               |
| status    | Integer | 任务状态：0-未开始，1-进行中，2-已完成 |
| startTime | String  | 任务开始时间                           |
| endTime   | String  | 任务结束时间                           |

---

## 六、状态码说明

### 活动状态（Activity Status）

| 状态值 | 说明   |
| ------ | ------ |
| 0      | 未开始 |
| 1      | 进行中 |
| 2      | 已结束 |
| 3      | 已取消 |

### 报名审核状态（Signup Status）

| 状态值 | 说明   |
| ------ | ------ |
| 0      | 待审核 |
| 1      | 通过   |
| 2      | 拒绝   |

### 任务状态（Task Status）

| 状态值 | 说明   |
| ------ | ------ |
| 0      | 未开始 |
| 1      | 进行中 |
| 2      | 已完成 |

### 用户角色（User Role）

| 角色值 | 说明   |
| ------ | ------ |
| 0      | 志愿者 |
| 1      | 负责人 |
| 2      | 管理员 |

---

## 七、错误码说明

所有接口统一使用 `Result` 格式返回，其中：

- `code = 1`: 请求成功
- `code = 0`: 请求失败，`msg` 字段包含具体错误信息

常见错误信息：

- `用户不存在`
- `活动不存在`
- `报名记录不存在`
- `报名记录已存在`
- `报名截止时间已过`
- `活动状态异常`
- `权限不足`
- `登录失败`

---

## 八、注意事项

1. **认证方式**: 除登录接口外，所有接口都需要在请求头中携带 JWT Token

   - 请求头字段名: `token`
   - 示例: `token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`

2. **时间格式**: 所有时间字段统一使用格式 `yyyy-MM-dd HH:mm:ss`

3. **分页参数**:

   - `page`: 页码从 1 开始
   - `pageSize`: 每页记录数，默认 10

4. **权限说明**:

   - 管理员（role=2）: 可访问 `/admin` 下的所有接口
   - 负责人（role=1）: 可访问 `/leader` 下的所有接口
   - 志愿者（role=0）: 可访问 `/volunteer` 下的所有接口

5. **数据校验**:
   - 所有必填字段必须提供
   - 时间字段需要符合指定格式
   - 状态字段需要在允许的枚举值范围内

---

## 九、接口列表汇总

### 公共接口

1. `POST /common/login` - 用户登录

### 管理员接口（/admin）

1. `GET /admin/user/list` - 分页查询用户列表
2. `PUT /admin/user/update` - 更新用户信息
3. `GET /admin/user/{id}` - 根据 ID 查询用户信息
4. `GET /admin/activity/list` - 获取所有活动信息
5. `PUT /admin/activity/update` - 更新活动信息

### 负责人接口（/leader）

1. `POST /leader/activity/create` - 创建活动
2. `GET /leader/activity/list` - 获取所有活动信息
3. `GET /leader/activity/self` - 获取自己负责的活动
4. `PUT /leader/activity/update` - 更新活动
5. `DELETE /leader/activity/delete` - 删除活动
6. `GET /leader/activity/signupRecords` - 获取报名记录
7. `PUT /leader/activity/audit` - 审核报名
8. `POST /leader/activity/taskAssign` - 任务分配
9. `GET /leader/activity/taskList` - 获取任务列表
10. `GET /leader/activity/userList` - 获取活动报名成功的用户列表

### 志愿者接口（/volunteer）

1. `POST /volunteer/activity/signup` - 报名志愿活动
2. `GET /volunteer/activity/taskList` - 获取任务列表
3. `PUT /volunteer/task/status` - 更新任务状态
4. `GET /volunteer/activity/list` - 获取所有活动信息
5. `GET /volunteer/activity/signupRecords` - 获取报名记录

---

**文档版本**: v1.0  
**最后更新**: 2024 年  
**维护人员**: 系统管理员
