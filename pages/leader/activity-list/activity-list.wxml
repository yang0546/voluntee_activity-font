<view class="page">
  <view class="top-bg"></view>

  <view class="nav-bar">
    <view class="nav-left">
      <text class="nav-title">负责人工作台</text>
      <text class="nav-sub">活动管理</text>
    </view>
  </view>

  <view class="hero-card">
    <view class="hero-left">
      <text class="hero-label">欢迎回来</text>
      <text class="hero-title">Hi，{{welcomeName || '负责人'}}</text>
      <text class="hero-sub">管理活动、审核报名、分配任务</text>
    </view>
    <view class="hero-stat">
      <text class="stat-label">{{activeTab === 'all' ? '全部活动' : '我的活动'}}</text>
      <text class="stat-value">{{activeTab === 'all' ? all.total : self.total}}</text>
    </view>
  </view>

  <view class="tabs">
    <view class="tab-item {{activeTab === 'all' ? 'active' : ''}}" data-key="all" bindtap="onTabChange">
      <text>全部活动</text>
    </view>
    <view class="tab-item {{activeTab === 'self' ? 'active' : ''}}" data-key="self" bindtap="onTabChange">
      <text>我的活动</text>
    </view>
  </view>

  <view class="card filter-card">
    <view class="card-header">
      <text class="card-title">筛选条件</text>
    </view>
    <view class="filter-grid">
      <view class="field">
        <text class="field-label">活动标题</text>
        <input class="input" placeholder="输入活动标题关键字" value="{{searchParams.title}}" bindinput="onSearchInput" />
      </view>
      <view class="field">
        <text class="field-label">状态</text>
        <picker mode="selector" range="{{statusOptions}}" range-key="label" value="{{statusIndex}}" bindchange="onStatusChange">
          <view class="picker">
            <text>{{statusOptions[statusIndex].label}}</text>
            <text class="chevron">⌄</text>
          </view>
        </picker>
      </view>
      <view class="filter-actions">
        <button class="primary-btn half" bindtap="onSearch">开始筛选</button>
        <button class="ghost-btn half" bindtap="onResetFilters">重置筛选</button>
      </view>
    </view>
  </view>

  <view class="section-head">
    <view>
      <text class="section-title">{{activeTab === 'all' ? '全部活动' : '我的活动'}}</text>
    </view>
    <button class="primary-btn sm" bindtap="createActivity">+ 创建活动</button>
  </view>

  <view class="list">
    <view class="activity-card" wx:for="{{activeTab === 'all' ? all.list : self.list}}" wx:key="id" data-id="{{item.id}}" bindtap="viewActivity">
      <view class="card-row">
        <view class="title-wrap">
          <text class="title">{{item.title || '未命名活动'}}</text>
          <text class="desc">{{item.description || '暂无简介'}}</text>
        </view>
        <text class="status-badge {{getStatusClass(item.status)}}">{{getStatusText(item.status)}}</text>
      </view>

      <view class="meta-grid">
        <view class="meta">
          <text class="meta-label">开始时间</text>
          <text class="meta-value time-value">{{item.startTimeDisplay || '未设置'}}</text>
        </view>
        <view class="meta">
          <text class="meta-label">地点</text>
          <text class="meta-value">{{item.location || '未设置'}}</text>
        </view>
        <view class="meta">
          <text class="meta-label">报名截止</text>
          <text class="meta-value time-value">{{item.deadlineDisplay || '未设置'}}</text>
        </view>
        <view class="meta">
          <text class="meta-label">人数</text>
          <text class="meta-value">{{item.currentPeople || 0}} / {{item.requiredPeople || 0}}</text>
        </view>
      </view>

      <view class="foot">
        <text class="leader">负责人：{{item.leaderName || '未设置'}}</text>
        <text class="card-chevron">›</text>
      </view>
    </view>

    <view class="load-more" wx:if="{{activeTab === 'all' ? all.loading : self.loading}}">加载中...</view>
    <view class="no-more" wx:if="{{(activeTab === 'all' ? !all.hasMore : !self.hasMore) && (activeTab === 'all' ? all.list.length : self.list.length) > 0}}">没有更多了</view>
    <view class="empty" wx:if="{{(activeTab === 'all' ? !all.loading : !self.loading) && (activeTab === 'all' ? all.list.length : self.list.length) === 0}}">暂无活动</view>
  </view>
</view>
