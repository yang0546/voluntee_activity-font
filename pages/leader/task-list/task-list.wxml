<view class="container">
  <view class="header-bar">
    <button class="assign-btn" bindtap="showAssign">+ 分配任务</button>
  </view>
  <scroll-view class="task-list" scroll-y refresher-enabled refresher-triggered="{{refreshing}}" bindrefresherrefresh="onPullDownRefresh">
    <view class="task-item" wx:for="{{taskList}}" wx:key="taskId">
      <view class="task-header">
        <view class="task-info">
          <text class="user-name">{{item.userName}}</text>
          <text class="task-content">{{item.content}}</text>
        </view>
        <text class="status-badge {{getStatusClass(item.status)}}">{{getStatusText(item.status)}}</text>
      </view>
      <view class="task-time">
        <text>⏰ {{formatTime(item.startTime)}} - {{formatTime(item.endTime)}}</text>
      </view>
    </view>
    <view class="empty" wx:if="{{!loading && taskList.length === 0}}">暂无任务</view>
  </scroll-view>
  
  <view class="modal" wx:if="{{showAssignModal}}" bindtap="hideAssign">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">分配任务</text>
        <text class="modal-close" bindtap="hideAssign">×</text>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">志愿者ID *</text>
          <input class="input" type="number" placeholder="请输入志愿者用户ID" value="{{assignForm.userId}}" data-field="userId" bindinput="onAssignInput" />
        </view>
        <view class="form-item">
          <text class="label">任务内容 *</text>
          <textarea class="textarea" placeholder="请输入任务内容" value="{{assignForm.content}}" data-field="content" bindinput="onAssignInput" />
        </view>
        <view class="form-item">
          <text class="label">开始时间 *</text>
          <picker mode="date" value="{{assignForm.startTime}}" data-field="startTime" bindchange="onAssignDateChange">
            <view class="picker-view">{{assignForm.startTime ? assignForm.startTime.split('T')[0] : '请选择日期'}}</view>
          </picker>
          <picker mode="time" value="{{assignForm.startTime}}" data-field="startTime" bindchange="onAssignTimeChange">
            <view class="picker-view">{{assignForm.startTime ? assignForm.startTime.split('T')[1] : '请选择时间'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">结束时间 *</text>
          <picker mode="date" value="{{assignForm.endTime}}" data-field="endTime" bindchange="onAssignDateChange">
            <view class="picker-view">{{assignForm.endTime ? assignForm.endTime.split('T')[0] : '请选择日期'}}</view>
          </picker>
          <picker mode="time" value="{{assignForm.endTime}}" data-field="endTime" bindchange="onAssignTimeChange">
            <view class="picker-view">{{assignForm.endTime ? assignForm.endTime.split('T')[1] : '请选择时间'}}</view>
          </picker>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn btn-cancel" bindtap="hideAssign">取消</button>
        <button class="btn btn-submit" bindtap="submitAssign">确定</button>
      </view>
    </view>
  </view>
</view>

