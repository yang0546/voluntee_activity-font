<view class="page detail-page">
  <block wx:if="{{activity}}">
    <view class="card detail-hero">
      <view class="detail-top">
        <view class="detail-title">{{activity.title}}</view>
        <view class="tag {{activity.statusClass}}">{{activity.statusText}}</view>
      </view>
      <view class="detail-meta">
        <text>{{activity.location || '地点待定'}}</text>
        <text class="dot">•</text>
        <text>{{activity.timeRange}}</text>
      </view>
      <view class="progress">
        <view class="progress-bar" style="width: {{activity.progress}}%;"></view>
      </view>
      <view class="progress-text">已报名 {{activity.currentPeople}} / {{activity.requiredPeople}}</view>
    </view>

    <view class="card">
      <view class="section-title">活动介绍</view>
      <view class="desc">{{activity.description || '暂无活动介绍'}}</view>
    </view>

    <view class="card info-card">
      <view class="info-row">
        <text class="label">负责人</text>
        <text class="value">{{activity.leaderName || '待分配'}}</text>
      </view>
      <view class="info-row">
        <text class="label">报名截止</text>
        <text class="value">{{activity.signupDeadline || '截止时间未定'}}</text>
      </view>
      <view class="info-row">
        <text class="label">开始时间</text>
        <text class="value">{{activity.startTime || '待定'}}</text>
      </view>
      <view class="info-row">
        <text class="label">结束时间</text>
        <text class="value">{{activity.endTime || '待定'}}</text>
      </view>
    </view>

    <block wx:if="{{showTasks}}">
      <view class="card">
        <view class="section-title">
          <view>我的任务</view>
          <text class="section-subtitle">{{tasksLoading ? '加载中...' : ''}}</text>
        </view>
        <block wx:if="{{tasks.length}}">
          <view wx:for="{{tasks}}" wx:key="taskId" class="task-item">
            <view class="task-top">
              <view class="task-title">{{item.content || '任务'}}</view>
              <view class="tag {{item.statusClass}}">{{item.statusText}}</view>
            </view>
            <view class="task-actions">
              <button
                size="mini"
                class="task-btn"
                data-id="{{item.taskId}}"
                data-status="{{item.status}}"
                bindtap="updateTaskStatus"
                loading="{{updatingTaskId === item.taskId}}"
                disabled="{{item.status === 2 || updatingTaskId === item.taskId}}"
              >
                {{ item.status === 2 ? '已完成' : (updatingTaskId === item.taskId ? '更新中' : (item.status === 1 ? '标记完成' : '开始任务')) }}
              </button>
            </view>
          </view>
        </block>
        <view wx:else class="empty">暂无任务</view>
      </view>
    </block>

    <view wx:if="{{showSignupButton}}" class="footer-actions">
      <button
        class="btn-primary"
        bindtap="handleSignup"
        loading="{{signing}}"
        disabled="{{signing}}"
      >
        {{signing ? '报名中...' : '报名参加'}}
      </button>
    </view>
  </block>
  <view wx:else class="empty">正在加载活动详情...</view>
</view>
